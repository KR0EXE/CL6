import sys
import random
from PyQt5.QtWidgets import QApplication, QWidget, QDesktopWidget
from PyQt5.QtCore import Qt, QTimer, QPointF
from PyQt5.QtGui import QPainter, QColor, QIcon

class OverlayWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()
        self.initParticles()
        
    def initUI(self):
        self.setWindowTitle("Screen Augmentation Overlay")
        # Removed Qt.Tool so that the window appears in the taskbar and Alt-Tab list.
        self.setWindowFlags(Qt.FramelessWindowHint | Qt.WindowStaysOnTopHint)
        # Set a custom icon that will appear on the desktop and taskbar.
        self.setWindowIcon(QIcon("unique_icon.png"))
        # Enable per-pixel transparency.
        self.setAttribute(Qt.WA_TranslucentBackground)
        # Make the window ignore mouse events so that you can interact with the desktop below.
        self.setAttribute(Qt.WA_TransparentForMouseEvents)
        
        # Resize to cover the entire screen.
        self.setGeometry(QDesktopWidget().screenGeometry())
        
        # Start a timer to update the animation.
        self.timer = QTimer(self)
        self.timer.timeout.connect(self.updateParticles)
        self.timer.start(30)  # Approximately 33 frames per second.
        
        self.show()
        
    def initParticles(self):
        # Create a list of particles with random attributes.
        self.particles = []
        for _ in range(100):
            x = random.uniform(0, self.width())
            y = random.uniform(0, self.height())
            dx = random.uniform(-2, 2)
            dy = random.uniform(-2, 2)
            radius = random.uniform(5, 15)
            color = QColor(
                random.randint(0, 255),
                random.randint(0, 255),
                random.randint(0, 255),
                random.randint(100, 200)  # Semi-transparent.
            )
            particle = {
                'pos': QPointF(x, y),
                'vel': QPointF(dx, dy),
                'radius': radius,
                'color': color
            }
            self.particles.append(particle)
    
    def updateParticles(self):
        # Update each particle's position and bounce off screen edges.
        for particle in self.particles:
            pos = particle['pos']
            vel = particle['vel']
            new_x = pos.x() + vel.x()
            new_y = pos.y() + vel.y()
            
            if new_x < 0 or new_x > self.width():
                vel.setX(-vel.x())
            if new_y < 0 or new_y > self.height():
                vel.setY(-vel.y())
            
            particle['pos'] = QPointF(pos.x() + vel.x(), pos.y() + vel.y())
        
        self.update()  # Trigger repaint.
    
    def paintEvent(self, event):
        painter = QPainter(self)
        painter.setRenderHint(QPainter.Antialiasing)
        
        # Draw a semi-transparent black rectangle to create a trailing effect.
        painter.fillRect(self.rect(), QColor(0, 0, 0, 10))
        
        # Draw each particle.
        for particle in self.particles:
            painter.setBrush(particle['color'])
            painter.setPen(Qt.NoPen)
            pos = particle['pos']
            radius = particle['radius']
            painter.drawEllipse(pos, radius, radius)

def main():
    app = QApplication(sys.argv)
    # Set the application icon so it appears in the taskbar.
    app.setWindowIcon(QIcon("unique_icon.png"))
    overlay = OverlayWindow()
    sys.exit(app.exec_())

if __name__ == "__main__":
    main()
